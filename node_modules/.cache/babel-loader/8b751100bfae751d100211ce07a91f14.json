{"ast":null,"code":"import { fromJS, Map, List } from 'immutable';\nimport { DefaultActionTypes, UserFactory, TodoFactory } from '../actions/default'; // import {\n//   Settings,\n// } from '../../models';\n\nconst initialUsers = [UserFactory({\n  id: 1,\n  name: 'Ryan'\n}), UserFactory({\n  id: 2,\n  name: 'Sandy'\n}), UserFactory({\n  id: 3,\n  name: 'Sean'\n}), UserFactory({\n  id: 4,\n  name: 'Peter'\n})];\nconst initialTodos = [TodoFactory({\n  id: 1,\n  userId: 1,\n  title: 'Drink Water',\n  complete: false\n})];\nconst INITIAL_STATE = fromJS({\n  lastUserId: initialUsers.length,\n  lastTodoId: initialTodos.length,\n  lastSubTodoId: 0,\n  users: Map().withMutations(mutableMap => {\n    initialUsers.forEach(user => {\n      mutableMap.set(user.get('id'), user);\n    });\n  }),\n  todos: Map().withMutations(mutableMap => {\n    initialTodos.forEach(todo => {\n      mutableMap.set(todo.get('id'), todo);\n      mutableMap.set(subTodo.get('id'), todo);\n    });\n  })\n});\nexport const reducer = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n    case DefaultActionTypes.ADD_USER:\n      {\n        const lastUserId = state.get('lastUserId');\n        const _ref = action,\n              payload = _ref.payload;\n        const user = payload.user;\n\n        if (user.get('name') === '') {\n          console.debug('no name!');\n          return state;\n        }\n\n        const userId = lastUserId + 1;\n        return state.withMutations(mutableState => {\n          mutableState.set('lastUserId', userId);\n          mutableState.setIn(['users', userId], user.set('id', userId));\n        });\n      }\n\n    case DefaultActionTypes.DELETE_USER:\n      {\n        const _ref2 = action,\n              payload = _ref2.payload;\n        const userId = payload.userId;\n        return state.withMutations(map => {\n          console.log(map);\n          map.removeIn(['users', userId]).removeIn(['todos', userId]);\n        });\n      }\n\n    case DefaultActionTypes.ADD_TODO:\n      {\n        const lastTodoId = state.get('lastTodoId');\n        const _ref3 = action,\n              payload = _ref3.payload;\n        const userId = payload.userId,\n              todo = payload.todo;\n\n        if (todo.get('title') === '') {\n          console.debug('no title!');\n          return state;\n        }\n\n        const todoId = lastTodoId + 1;\n        return state.withMutations(mutableState => {\n          mutableState.set('lastTodoId', todoId);\n          mutableState.setIn(['todos', todoId], todo.withMutations(mutableTodo => {\n            mutableTodo.set('id', todoId);\n            mutableTodo.set('userId', userId);\n          }));\n        });\n      }\n\n    case DefaultActionTypes.ADD_SUB_TODO:\n      {\n        const lastSubTodoId = state.get('lastSubTodoId');\n        console.log('lastSubTodoId', lastSubTodoId);\n        const _ref4 = action,\n              payload = _ref4.payload;\n        const subTodo = payload.subTodo,\n              todoId = payload.todoId;\n\n        if (subTodo.get('title') === '') {\n          return state;\n        }\n\n        let subTodoId = lastSubTodoId + 1;\n        console.log('subTodoId', subTodoId);\n        return state.withMutations(mutableTodo => {\n          console.log('mutableState', mutableTodo);\n          mutableTodo.setIn(['subTodo', subTodoId], subTodo.withMutations(mutableSubTodo => {\n            mutableSubTodo.set('todoId', todoId);\n            mutableSubTodo.set('id', subTodoId);\n            mutableSubTodo.set('subTodo', List(subTodo));\n          }));\n        });\n      }\n\n    case DefaultActionTypes.COMPLETE_TODO:\n      {\n        const _ref5 = action,\n              payload = _ref5.payload;\n        const todo = payload.todo,\n              complete = payload.complete;\n        let id = todo.get('id');\n        return state.withMutations(mutableState => {\n          mutableState.setIn(['todos', id], todo.withMutations(mutableTodo => {\n            mutableTodo.set('complete', !complete);\n          }));\n        });\n      }\n\n    case DefaultActionTypes.DELETE_TODO:\n      {\n        const _ref6 = action,\n              payload = _ref6.payload;\n        const todo = payload.todo;\n        return state.withMutations(map => {\n          let id = todo.get('id');\n          map.removeIn(['todos', id]);\n        });\n      }\n\n    default:\n      return state;\n  }\n};\nexport default reducer;","map":{"version":3,"sources":["/Users/m5/allied-technical-test-5/test-6/src/reducers/default.ts"],"names":["fromJS","Map","List","DefaultActionTypes","UserFactory","TodoFactory","initialUsers","id","name","initialTodos","userId","title","complete","INITIAL_STATE","lastUserId","length","lastTodoId","lastSubTodoId","users","withMutations","mutableMap","forEach","user","set","get","todos","todo","subTodo","reducer","state","action","type","ADD_USER","payload","console","debug","mutableState","setIn","DELETE_USER","map","log","removeIn","ADD_TODO","todoId","mutableTodo","ADD_SUB_TODO","subTodoId","mutableSubTodo","COMPLETE_TODO","DELETE_TODO"],"mappings":"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","sourcesContent":["import {\n  fromJS,\n  Record,\n  Map,\n  List,\n} from 'immutable';\nimport {\n  IAction,\n} from '../Interfaces';\n\nimport {\n  DefaultActionTypes,\n  ITodo,\n  AddTodoAction,\n  AddSubTodoAction,\n  DeleteTodoAction,\n  CompletedTodoAction,\n  IUser,\n  AddUserAction,\n  DeleteUserAction,\n  UserFactory,\n  TodoFactory\n} from '../actions/default';\n\n\n// import {\n//   Settings,\n// } from '../../models';\n\nexport interface IReducerState {\n  lastUserId: number;\n  lastTodoId: number;\n  lastSubTodoId: number;\n  users: Map<number, Record<IUser>>;\n  todos: Map<number, Record<ITodo>>;\n}\n\nconst initialUsers = [\n  UserFactory({\n    id: 1,\n    name: 'Ryan',\n  }),\n  UserFactory({\n    id: 2,\n    name: 'Sandy',\n  }),\n  UserFactory({\n    id: 3,\n    name: 'Sean',\n  }),\n  UserFactory({\n    id: 4,\n    name: 'Peter',\n  }),\n]\n\nconst initialTodos = [\n  TodoFactory({\n    id: 1,\n    userId: 1,\n    title: 'Drink Water',\n    complete: false,\n  })\n]\nconst INITIAL_STATE = fromJS({\n  lastUserId: initialUsers.length,\n  lastTodoId: initialTodos.length,\n  lastSubTodoId: 0,\n  users: Map<number, Record<IUser>>().withMutations((mutableMap) => {\n    initialUsers.forEach((user) => {\n      mutableMap.set(user.get('id'), user);\n    })\n  }),\n  todos: Map<number, Record<ITodo>>().withMutations((mutableMap) => {\n    initialTodos.forEach((todo) => {\n      mutableMap.set(todo.get('id'), todo);\n      mutableMap.set(subTodo.get('id'), todo);\n    })\n  }),\n});\n\nexport const reducer = (state: Record<IReducerState> = INITIAL_STATE, action: IAction) => {\n  switch (action.type) {\n    case DefaultActionTypes.ADD_USER: {\n      const lastUserId = state.get('lastUserId');\n      const {\n        payload,\n      } = action as AddUserAction;\n      const {\n        user,\n      } = payload;\n\n      if (user.get('name') === '') {\n        console.debug('no name!')\n        return state;\n      }\n\n      const userId = lastUserId + 1;\n      return state.withMutations((mutableState) => {\n        mutableState.set('lastUserId', userId);\n        mutableState.setIn(\n          ['users', userId],\n          user.set('id', userId),\n        );\n      })\n    }\n\n    case DefaultActionTypes.DELETE_USER: {\n      const {\n        payload,\n      } = action as DeleteUserAction;\n      const {\n        userId,\n      } = payload;\n\n      return state.withMutations((map) => {\n        console.log(map)\n        map\n          .removeIn(['users', userId])\n          .removeIn(['todos', userId])\n      });\n    }\n\n    case DefaultActionTypes.ADD_TODO: {\n      const lastTodoId = state.get('lastTodoId');\n      const {\n       payload,\n      } = action as AddTodoAction;\n      const {\n       userId,\n       todo,\n      } = payload;\n\n      if (todo.get('title') === '') {\n        console.debug('no title!')\n        return state;\n      }\n\n      const todoId = lastTodoId + 1;\n      return state.withMutations((mutableState) => {\n        mutableState.set('lastTodoId', todoId);\n        mutableState.setIn( \n          ['todos', todoId],\n          todo.withMutations((mutableTodo) => {\n            mutableTodo.set('id', todoId)\n            mutableTodo.set('userId', userId)\n          }),\n        );\n      });\n    }\n\n    case DefaultActionTypes.ADD_SUB_TODO: {\n      const lastSubTodoId = state.get('lastSubTodoId');\n      console.log('lastSubTodoId', lastSubTodoId)\n      const {\n       payload,\n      } = action as AddSubTodoAction;\n      const { \n       subTodo,\n       todoId,\n      } = payload;\n      \n      if (subTodo.get('title') === '') {\n        return state;\n      }\n\n      let subTodoId = lastSubTodoId + 1;\n      console.log('subTodoId', subTodoId)\n      return state.withMutations((mutableTodo) => {\n        console.log('mutableState', mutableTodo)\n        mutableTodo.setIn( \n          ['subTodo', subTodoId],\n          subTodo.withMutations((mutableSubTodo: any) => {\n            mutableSubTodo.set('todoId', todoId)\n            mutableSubTodo.set('id', subTodoId)\n            mutableSubTodo.set('subTodo', List(subTodo))\n          }),     \n        );\n       });\n    }\n\n    case DefaultActionTypes.COMPLETE_TODO: {\n      const {\n        payload,\n      } = action as CompletedTodoAction;\n      const {\n        todo,\n        complete\n      } = payload;\n      let id = todo.get('id')\n      return state.withMutations((mutableState) => {\n        mutableState.setIn( \n        ['todos', id],\n        todo.withMutations((mutableTodo) => {\n          mutableTodo.set('complete', !complete)\n        }),\n      );\n      })\n    }\n\n    case DefaultActionTypes.DELETE_TODO: {\n      const {\n        payload,\n      } = action as DeleteTodoAction;\n      const {\n        todo,\n      } = payload;\n      return state.withMutations((map) => {\n        let id = todo.get('id')\n        map\n          .removeIn(['todos', id])\n      });\n    }\n\n    default:\n      return state;\n  }\n};\n\nexport default reducer;\n"]},"metadata":{},"sourceType":"module"}